import { Shader } from "./shader";
import { VertexArray } from "./vertexArray";
import { Camera } from "./camera";
import * as glm from "gl-matrix";
import * as obj from "obj-file-parser-ts";

export let gl: WebGL2RenderingContext | null;
let glCanvas: HTMLElement | null;

const vertexSource: string = `#version 300 es
    layout(location = 0) in vec3 position;

    uniform mat4 model;
    uniform mat4 view;
    uniform mat4 proj;

    out vec4 vert_color;

    void main() {
      gl_Position = proj * view * model * vec4(position, 1.0);
      vert_color = vec4(position.x + 0.5, position.y + 0.5, position.z + 0.5, 1.0);
    }`;

const fragmentSource: string = `#version 300 es
    #ifdef GL_ES
        precision highp float;
    #endif

    in vec4 vert_color;
    out vec4 color;

    void main() {
            color = vert_color;
    }`;

let vertices: Float32Array;
let indices: Int32Array;

let shader: Shader;
let array: VertexArray | null = null;
let camera: Camera;

let translate: glm.vec3;

let width: number;
let height: number;

let lastX: number = 0;
let lastY: number = 0;

let currentX: number = 0;
let currentY: number = 0;

let wheelOffset: number = 0;

let firstMove: boolean = true;

function glCanvasOnMouseMove(e: MouseEvent): void {
  var rect = glCanvas.getBoundingClientRect();
  currentX = e.clientX - rect.left;
  currentY = e.clientY - rect.top;

  if (firstMove) {
    lastX = currentX;
    lastY = currentY;
    firstMove = false;
  }
}

function glCanvasOnWheel(e: WheelEvent): void {
  wheelOffset = e.deltaY;
}

function glCanvasOnResize(): void {
  width = glCanvas.clientWidth;
  height = glCanvas.clientHeight;

  gl.canvas.width = width;
  gl.canvas.height = height;

  gl.viewport(0, 0, width, height);

  console.log(width, height);
}

function startup(): void {
  glCanvas = document.getElementById("canvas");

  glCanvas.addEventListener("mousemove", glCanvasOnMouseMove);
  glCanvas.addEventListener("wheel", glCanvasOnWheel);
  glCanvas.addEventListener("resize", glCanvasOnResize);

  gl = (glCanvas as HTMLCanvasElement).getContext("webgl2");

  width = glCanvas.clientWidth;
  height = glCanvas.clientHeight;
  console.log(width, height);

  gl.canvas.width = width;
  gl.canvas.height = height;
  gl.viewport(0, 0, width, height);

  shader = new Shader(vertexSource, fragmentSource);

  vertices = new Float32Array([-1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1, 1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, 1]);
  indices = new Int32Array([0, 1, 3, 3, 1, 2, 1, 5, 2, 2, 5, 6, 5, 4, 6, 6, 4, 7, 4, 0, 7, 7, 0, 3, 3, 2, 7, 7, 2, 6, 4, 5, 0, 0, 5, 1]);

  camera = new Camera();
  translate = glm.vec3.create();
  translate[0] = 0.0;
  translate[1] = 0.0;
  translate[2] = 0.0;

  const file: string = `# Blender v2.80 (sub 51) OBJ File: ''
# www.blender.org
mtllib box.mtl
o Cube_Cube.003
v -0.183331 -0.352359 -0.294199
v -0.183331 0.352359 -0.294199
v -0.171835 0.352359 -0.294199
v -0.171835 -0.352359 -0.294199
v -0.171835 -0.311313 -0.279125
v -0.171835 -0.311313 0.279125
v -0.171835 0.114182 0.279125
v -0.171835 0.185221 0.370652
v -0.171835 0.090630 0.399346
v -0.171835 -0.007741 0.409035
v -0.171835 -0.106113 0.399346
v -0.171835 -0.200704 0.370652
v -0.171835 -0.287880 0.324056
v -0.171835 -0.352359 0.271139
v -0.183331 -0.352359 0.271139
v -0.183331 0.352359 0.257020
v -0.171835 0.352359 0.257020
v -0.171835 0.348807 0.261347
v -0.183331 0.348807 0.261347
v -0.183331 0.185221 0.370652
v -0.183331 0.090630 0.399346
v -0.183331 -0.007741 0.409035
v -0.183331 -0.106113 0.399346
v -0.183331 -0.200704 0.370652
v -0.183331 0.272397 0.324056
v -0.171835 0.272397 0.324056
v -0.183331 -0.287880 0.324056
v 0.191672 -0.012270 -0.061683
v 0.191672 0.000000 -0.062892
v 0.191672 0.012269 -0.061683
v 0.191672 0.024067 -0.058104
v 0.191672 0.034941 -0.052292
v 0.191672 0.044471 -0.044471
v 0.191672 0.052292 -0.034941
v 0.191672 0.058104 -0.024068
v 0.191672 0.061683 -0.012270
v 0.191672 0.062891 0.000000
v 0.191672 0.061683 0.012269
v 0.191672 0.058104 0.024067
v 0.191672 0.052292 0.034941
v 0.191672 0.044471 0.044471
v 0.191672 0.034941 0.052292
v 0.191672 0.024068 0.058104
v 0.191672 0.012269 0.061683
v 0.191672 -0.000000 0.062891
v 0.191672 -0.012270 0.061683
v 0.191672 -0.024068 0.058104
v 0.191672 -0.034941 0.052292
v 0.191672 -0.044471 0.044471
v 0.191672 -0.052292 0.034941
v 0.191672 -0.058104 0.024068
v 0.191672 -0.061683 0.012270
v 0.191672 -0.062892 -0.000000
v 0.191672 -0.061683 -0.012270
v 0.191672 -0.058104 -0.024068
v 0.191672 -0.052292 -0.034941
v 0.191672 -0.044471 -0.044471
v 0.191672 -0.034941 -0.052292
v 0.191672 -0.024068 -0.058104
v -0.056974 0.114182 -0.279125
v -0.171835 0.114182 -0.279125
v -0.056974 0.114182 0.279125
v -0.056974 -0.311313 0.279125
v -0.056974 -0.311313 -0.279125
v 0.173978 -0.311313 0.279125
v 0.058502 -0.311313 0.279125
v 0.058502 -0.311313 -0.279125
v 0.173978 -0.311313 -0.279125
v -0.056974 -0.311313 0.069396
v -0.056974 -0.248316 0.069396
v -0.056974 -0.164943 0.279125
v 0.173978 0.114182 -0.279125
v 0.058502 0.114182 -0.279125
v 0.058502 0.114182 0.279125
v 0.173978 0.114182 0.279125
v 0.173978 -0.000000 0.062891
v 0.173978 0.012269 0.061683
v 0.173978 0.024068 0.058104
v 0.173978 0.034941 0.052292
v 0.173978 0.044471 0.044471
v 0.173978 0.052292 0.034941
v 0.173978 0.058104 0.024067
v 0.173978 0.061683 0.012269
v 0.173978 0.062891 0.000000
v 0.173978 0.061683 -0.012270
v 0.173978 0.058104 -0.024068
v 0.173978 0.052292 -0.034941
v 0.173978 0.044471 -0.044471
v 0.173978 0.034941 -0.052292
v 0.173978 0.024067 -0.058104
v 0.173978 0.012269 -0.061683
v 0.173978 0.000000 -0.062892
v -0.056974 -0.164943 -0.279125
v -0.056974 -0.248316 -0.069396
v -0.056974 -0.311313 -0.069396
v 0.058502 -0.164943 -0.279125
v 0.058502 -0.164943 0.279125
v 0.058502 -0.000000 0.028755
v 0.058502 -0.005610 0.028203
v 0.058502 -0.011004 0.026566
v 0.058502 -0.015976 0.023909
v 0.058502 -0.020333 0.020333
v 0.058502 -0.023909 0.015976
v 0.058502 -0.026567 0.011004
v 0.058502 -0.028203 0.005610
v 0.058502 -0.028755 -0.000000
v 0.058502 -0.028203 -0.005610
v 0.058502 -0.026567 -0.011004
v 0.058502 -0.023909 -0.015976
v 0.058502 -0.020333 -0.020333
v 0.058502 -0.015976 -0.023909
v 0.058502 -0.011004 -0.026566
v 0.058502 -0.005610 -0.028203
v 0.058502 0.000000 -0.028755
v -0.056974 0.000000 -0.028755
v -0.056974 -0.005610 -0.028203
v -0.056974 -0.011004 -0.026566
v -0.056974 -0.015976 -0.023909
v -0.056974 -0.020333 -0.020333
v -0.056974 -0.023909 -0.015976
v -0.056974 -0.026567 -0.011004
v -0.056974 -0.028203 -0.005610
v -0.056974 -0.028755 -0.000000
v -0.056974 -0.028203 0.005610
v -0.056974 -0.026567 0.011004
v -0.056974 -0.023909 0.015976
v -0.056974 -0.020333 0.020333
v -0.056974 -0.015976 0.023909
v -0.056974 -0.011004 0.026566
v -0.056974 -0.005610 0.028203
v -0.056974 -0.000000 0.028755
v -0.056974 0.028755 0.000000
v 0.058502 0.028755 0.000000
v 0.058502 0.028203 -0.005610
v -0.056974 0.028203 -0.005610
v -0.056974 0.005610 -0.028203
v 0.058502 0.005610 -0.028203
v 0.058502 0.005610 0.028203
v -0.056974 0.005610 0.028203
v -0.056974 0.026566 -0.011004
v 0.058502 0.026566 -0.011004
v 0.058502 0.023909 -0.015976
v -0.056974 0.023909 -0.015976
v -0.056974 0.011004 -0.026566
v 0.058502 0.011004 -0.026566
v -0.056974 0.011004 0.026566
v 0.058502 0.011004 0.026566
v 0.058502 0.015976 0.023909
v -0.056974 0.015976 0.023909
v -0.056974 0.020333 0.020333
v -0.056974 0.023909 0.015976
v -0.056974 0.026566 0.011004
v -0.056974 0.028203 0.005610
v -0.056974 0.020333 -0.020333
v -0.056974 0.015976 -0.023909
v 0.058502 0.020333 -0.020333
v 0.058502 0.015976 -0.023909
v 0.058502 0.028203 0.005610
v 0.058502 0.026566 0.011004
v 0.058502 0.023909 0.015976
v 0.058502 0.020333 0.020333
v 0.173978 -0.062892 -0.000000
v 0.173978 -0.061683 0.012270
v 0.173978 -0.052292 0.034941
v 0.173978 -0.044471 0.044471
v 0.173978 -0.058104 0.024068
v 0.173978 -0.058104 -0.024068
v 0.173978 -0.061683 -0.012270
v 0.173978 -0.044471 -0.044471
v 0.173978 -0.052292 -0.034941
v 0.173978 -0.012270 0.061683
v 0.173978 -0.034941 -0.052292
v 0.173978 -0.024068 -0.058104
v 0.173978 -0.034941 0.052292
v 0.173978 -0.024068 0.058104
v 0.173978 -0.012270 -0.061683
v 0.058502 -0.311313 0.069396
v 0.058502 -0.311313 -0.069396
v 0.058502 -0.248316 -0.069396
v 0.058502 -0.248316 0.069396
vt 0.976245 0.671027
vt 0.972341 0.987973
vt 0.976245 0.987973
vt 0.736763 0.877224
vt 0.746509 0.919766
vt 0.777599 0.778146
vt 0.984054 0.925287
vt 0.980150 0.671027
vt 0.980150 0.925287
vt 0.987959 0.920883
vt 0.984054 0.672973
vt 0.984054 0.920883
vt 0.987959 0.671027
vt 0.984054 0.671027
vt 0.976245 0.780499
vt 0.980150 0.739426
vt 0.976245 0.739426
vt 0.976245 0.868558
vt 0.980150 0.824101
vt 0.976245 0.824101
vt 0.976245 0.912160
vt 0.980150 0.868558
vt 0.976245 0.702462
vt 0.980150 0.671027
vt 0.976245 0.671027
vt 0.026023 0.993657
vt 0.026023 0.157665
vt 0.686627 0.683173
vt 0.980150 0.702462
vt 0.980150 0.780499
vt 0.976245 0.953233
vt 0.980150 0.912160
vt 0.976245 0.984425
vt 0.980150 0.953233
vt 0.874378 0.483997
vt 0.923351 0.470523
vt 0.838512 0.376760
vt 0.866151 0.144067
vt 0.884926 0.265167
vt 0.884926 0.144067
vt 0.866151 0.265167
vt 0.847377 0.144067
vt 0.847377 0.265167
vt 0.916925 0.022968
vt 0.935800 0.144067
vt 0.935800 0.022968
vt 0.839589 0.219671
vt 0.823452 0.265167
vt 0.954675 0.144067
vt 0.935800 0.022968
vt 0.935800 0.144067
vt 0.916925 0.236368
vt 0.898050 0.144067
vt 0.898050 0.236368
vt 0.935800 0.144067
vt 0.954575 0.236368
vt 0.954575 0.144067
vt 0.838993 0.083518
vt 0.838796 0.086179
vt 0.847377 0.144067
vt 0.916925 0.144067
vt 0.935800 0.236368
vt 0.935800 0.144067
vt 0.839589 0.189563
vt 0.823452 0.144067
vt 0.893001 0.022968
vt 0.870650 0.082301
vt 0.870740 0.083518
vt 0.801101 0.203400
vt 0.801192 0.204617
vt 0.156886 0.131091
vt 0.164632 0.015298
vt 0.156886 0.015298
vt 0.179383 0.131091
vt 0.185823 0.015298
vt 0.179383 0.015298
vt 0.172228 0.131091
vt 0.172228 0.015298
vt 0.047945 0.015298
vt 0.040200 0.131091
vt 0.047945 0.131091
vt 0.142135 0.131091
vt 0.149290 0.015298
vt 0.142135 0.015298
vt 0.149290 0.131091
vt 0.130218 0.131091
vt 0.135695 0.015298
vt 0.130218 0.015298
vt 0.222356 0.015298
vt 0.214760 0.131091
vt 0.222356 0.131091
vt 0.101282 0.131091
vt 0.109027 0.015298
vt 0.101282 0.015298
vt 0.032604 0.015298
vt 0.025448 0.131091
vt 0.032604 0.131091
vt 0.093686 0.131091
vt 0.093686 0.015298
vt 0.229511 0.015298
vt 0.229511 0.131091
vt 0.192263 0.015298
vt 0.185823 0.131091
vt 0.192263 0.131091
vt 0.116623 0.131091
vt 0.123778 0.015298
vt 0.116623 0.015298
vt 0.791791 0.204617
vt 0.791882 0.203400
vt 0.777828 0.144067
vt 0.199418 0.015298
vt 0.199418 0.131091
vt 0.074613 0.131091
vt 0.080090 0.015298
vt 0.074613 0.015298
vt 0.019009 0.015298
vt 0.013532 0.131091
vt 0.019009 0.131091
vt 0.861340 0.083518
vt 0.861430 0.082301
vt 0.847377 0.022968
vt 0.040200 0.015298
vt 0.080090 0.131091
vt 0.086530 0.015298
vt 0.123779 0.131091
vt 0.130218 0.015298
vt 0.069137 0.015298
vt 0.062697 0.131091
vt 0.069137 0.131091
vt 0.214760 0.015298
vt 0.207014 0.131091
vt 0.135695 0.131091
vt 0.055542 0.015298
vt 0.055542 0.131091
vt 0.164632 0.131091
vt 0.109027 0.131091
vt 0.235951 0.015298
vt 0.235951 0.131091
vt 0.207014 0.015298
vt 0.086530 0.131091
vt 0.062697 0.015298
vt 0.025448 0.015298
vt 0.074613 0.015298
vt 0.074613 0.131091
vt 0.985100 0.504722
vt 0.966288 0.493061
vt 0.966288 0.504722
vt 0.985100 0.469511
vt 0.966288 0.458527
vt 0.966288 0.469511
vt 0.985100 0.481172
vt 0.966288 0.481172
vt 0.985100 0.404222
vt 0.966288 0.392562
vt 0.966288 0.404222
vt 0.985100 0.525591
vt 0.966288 0.515706
vt 0.966288 0.525591
vt 0.985100 0.515706
vt 0.966288 0.371692
vt 0.947476 0.363285
vt 0.947476 0.371692
vt 0.966288 0.427772
vt 0.947476 0.416111
vt 0.947476 0.427772
vt 0.947476 0.489579
vt 0.966288 0.501468
vt 0.966288 0.489579
vt 0.985100 0.381578
vt 0.966288 0.371692
vt 0.966288 0.381578
vt 0.947476 0.477918
vt 0.966288 0.477918
vt 0.966288 0.438756
vt 0.947476 0.438756
vt 0.966288 0.381578
vt 0.947476 0.381578
vt 0.947476 0.513128
vt 0.966288 0.524113
vt 0.966288 0.513128
vt 0.966288 0.392562
vt 0.947476 0.392562
vt 0.985100 0.458527
vt 0.966288 0.448642
vt 0.966288 0.457048
vt 0.947476 0.448642
vt 0.947476 0.457048
vt 0.985100 0.392562
vt 0.947476 0.457048
vt 0.966288 0.466934
vt 0.966288 0.457048
vt 0.947476 0.524113
vt 0.966288 0.533998
vt 0.985100 0.438756
vt 0.966288 0.427772
vt 0.966288 0.438756
vt 0.966288 0.416111
vt 0.947476 0.404222
vt 0.985100 0.533998
vt 0.966288 0.533998
vt 0.985100 0.416111
vt 0.966288 0.416111
vt 0.985100 0.493061
vt 0.947476 0.501468
vt 0.966288 0.448642
vt 0.947476 0.466934
vt 0.966288 0.404222
vt 0.985100 0.427772
vt 0.985100 0.371692
vt 0.966288 0.363285
vt 0.777828 0.022968
vt 0.818433 0.083518
vt 0.818631 0.080856
vt 0.985100 0.448642
vt 0.966288 0.448642
vt 0.973349 0.236368
vt 0.954575 0.144067
vt 0.954575 0.236368
vt 0.777828 0.022968
vt 0.777828 0.022968
vt 0.777828 0.022968
vt 0.967220 0.778146
vt 0.972341 0.671027
vt 0.954675 0.022968
vt 0.954675 0.098572
vt 0.954675 0.144067
vt 0.916925 0.266476
vt 0.898050 0.236368
vt 0.898050 0.266476
vt 0.935800 0.266476
vt 0.916925 0.236368
vt 0.916925 0.266476
vt 0.884926 0.169117
vt 0.892714 0.194167
vt 0.892714 0.169117
vt 0.892714 0.169117
vt 0.884926 0.144067
vt 0.884926 0.169117
vt 0.954675 0.022968
vt 0.954675 0.098572
vt 0.954675 0.144067
vt 0.909137 0.098572
vt 0.893001 0.144067
vt 0.916925 0.144067
vt 0.909137 0.068464
vt 0.780311 0.987972
vt 0.967220 0.969512
vt 0.777599 0.969512
vt 0.746510 0.746197
vt 0.736763 0.788739
vt 0.733472 0.832981
vt 0.762337 0.958973
vt 0.984054 0.671027
vt 0.987959 0.672973
vt 0.564510 0.157665
vt 0.614913 0.234155
vt 0.659296 0.337570
vt 0.686627 0.449782
vt 0.695856 0.566478
vt 0.659296 0.795385
vt 0.614913 0.898800
vt 0.555183 0.989443
vt 0.551061 0.993657
vt 0.980150 0.984425
vt 0.932620 0.462116
vt 0.939902 0.452231
vt 0.944919 0.441247
vt 0.947476 0.429586
vt 0.947476 0.417697
vt 0.944919 0.406036
vt 0.939902 0.395052
vt 0.932620 0.385167
vt 0.923351 0.376760
vt 0.912452 0.370155
vt 0.900342 0.365605
vt 0.887486 0.363285
vt 0.874378 0.363285
vt 0.861522 0.365605
vt 0.849411 0.370155
vt 0.829243 0.385167
vt 0.821961 0.395052
vt 0.816945 0.406036
vt 0.814388 0.417697
vt 0.814388 0.429586
vt 0.816945 0.441247
vt 0.821961 0.452231
vt 0.829243 0.462116
vt 0.838512 0.470523
vt 0.849411 0.477128
vt 0.861521 0.481678
vt 0.887486 0.483997
vt 0.900342 0.481678
vt 0.912452 0.477128
vt 0.866151 0.265167
vt 0.866151 0.144067
vt 0.847377 0.219671
vt 0.954675 0.022968
vt 0.916925 0.144067
vt 0.935800 0.236368
vt 0.847377 0.022968
vt 0.828713 0.069875
vt 0.830719 0.070137
vt 0.832647 0.070913
vt 0.830719 0.096898
vt 0.828713 0.097161
vt 0.832647 0.096122
vt 0.834424 0.072174
vt 0.835982 0.073871
vt 0.834424 0.094861
vt 0.835982 0.093165
vt 0.837261 0.075938
vt 0.838211 0.078297
vt 0.837261 0.091097
vt 0.838211 0.088739
vt 0.838796 0.080856
vt 0.916925 0.236368
vt 0.847377 0.189563
vt 0.866040 0.089755
vt 0.847377 0.144067
vt 0.866957 0.089636
vt 0.866957 0.077400
vt 0.866040 0.077280
vt 0.867839 0.089281
vt 0.867839 0.077755
vt 0.868651 0.078331
vt 0.868651 0.088704
vt 0.869364 0.087928
vt 0.869364 0.079107
vt 0.869948 0.080052
vt 0.869948 0.086983
vt 0.870383 0.085905
vt 0.870383 0.081131
vt 0.870650 0.084735
vt 0.796492 0.210855
vt 0.777828 0.265167
vt 0.797409 0.210735
vt 0.797409 0.198499
vt 0.796492 0.198379
vt 0.798290 0.210380
vt 0.798290 0.198854
vt 0.799103 0.199430
vt 0.799103 0.209803
vt 0.799815 0.209028
vt 0.799815 0.200206
vt 0.800400 0.201151
vt 0.800400 0.208082
vt 0.800834 0.207004
vt 0.800834 0.202230
vt 0.801101 0.205834
vt 0.185823 0.131091
vt 0.185823 0.015298
vt 0.795575 0.210735
vt 0.794693 0.210380
vt 0.795575 0.198499
vt 0.794693 0.198854
vt 0.793880 0.209803
vt 0.793168 0.209028
vt 0.793880 0.199430
vt 0.793168 0.200206
vt 0.792583 0.208082
vt 0.792149 0.207004
vt 0.792583 0.201151
vt 0.792149 0.202230
vt 0.791882 0.205834
vt 0.013532 0.015298
vt 0.865123 0.089636
vt 0.864242 0.089281
vt 0.865123 0.077400
vt 0.864242 0.077755
vt 0.863429 0.088704
vt 0.862717 0.087928
vt 0.863429 0.078331
vt 0.862717 0.079107
vt 0.862132 0.086983
vt 0.861698 0.085905
vt 0.862132 0.080052
vt 0.861698 0.081131
vt 0.861430 0.084735
vt 0.130218 0.131091
vt 0.966288 0.363285
vt 0.985100 0.448642
vt 0.947476 0.533998
vt 0.985100 0.363285
vt 0.826708 0.070137
vt 0.824779 0.070913
vt 0.777828 0.144067
vt 0.824779 0.096122
vt 0.821444 0.093165
vt 0.823002 0.094861
vt 0.826708 0.096898
vt 0.823002 0.072174
vt 0.821444 0.073871
vt 0.820166 0.091097
vt 0.819216 0.088739
vt 0.820166 0.075938
vt 0.819216 0.078297
vt 0.818631 0.086179
vt 0.973349 0.144067
vt 0.785107 0.671027
vt 0.783637 0.672624
vt 0.762337 0.706989
vt 0.954675 0.068464
vt 0.916925 0.236368
vt 0.935800 0.236368
vt 0.884926 0.194167
vt 0.892714 0.144067
vt 0.954675 0.068464
vt 0.916925 0.098572
vt 0.916925 0.068464
vn 0.0000 0.0000 -1.0000
vn 1.0000 0.0000 0.0000
vn 0.0000 -1.0000 -0.0000
vn 0.0000 1.0000 0.0000
vn 0.0000 0.7729 0.6345
vn 0.0000 0.2903 0.9569
vn 0.0000 -0.0980 0.9952
vn 0.0000 -0.2903 0.9569
vn 0.0000 0.6344 0.7730
vn -1.0000 0.0000 0.0000
vn 0.0000 0.4714 0.8819
vn 0.0000 0.0980 0.9952
vn 0.0000 -0.4714 0.8819
vn 0.0000 -0.6344 0.7730
vn 0.0000 -0.0000 1.0000
vn 0.0000 -0.9952 0.0979
vn 0.0000 -0.7730 0.6344
vn 0.0000 -0.8819 0.4715
vn 0.0000 0.9952 -0.0979
vn 0.0000 -0.9570 -0.2902
vn 0.0000 -0.9952 -0.0979
vn 0.0000 -0.7730 -0.6344
vn 0.0000 0.0979 -0.9952
vn 0.0000 0.0979 0.9952
vn 0.0000 0.8820 -0.4713
vn 0.0000 -0.0979 0.9952
vn 0.0000 0.2904 -0.9569
vn 0.0000 -0.6344 -0.7730
vn 0.0000 0.4713 0.8820
vn 0.0000 -0.4713 -0.8820
vn 0.0000 0.6344 -0.7730
vn 0.0000 0.9569 -0.2904
vn 0.0000 -0.4713 0.8820
vn 0.0000 0.8820 0.4713
vn 0.0000 -0.0979 -0.9952
vn 0.0000 -0.8819 -0.4715
vn 0.0000 0.9952 0.0979
vn 0.0000 -0.9570 0.2902
vn 0.0000 0.2904 0.9569
vn 0.0000 0.4713 -0.8820
vn 0.0000 -0.2904 -0.9569
vn 0.0000 -0.2904 0.9569
vn 0.0000 0.9569 0.2904
vn 0.0000 0.7730 -0.6344
vn 0.0000 0.7730 0.6344
vn 0.0000 -0.9952 0.0981
vn 0.0000 -0.8819 0.4714
vn 0.0000 0.9952 -0.0980
vn 0.0000 -0.9569 -0.2903
vn 0.0000 -0.9952 -0.0981
vn 0.0000 0.0981 -0.9952
vn 0.0000 0.8819 -0.4714
vn 0.0000 0.2903 -0.9569
vn 0.0000 -0.4714 -0.8819
vn 0.0000 0.9569 -0.2903
vn 0.0000 0.8819 0.4714
vn 0.0000 -0.0981 -0.9952
vn 0.0000 -0.8819 -0.4714
vn 0.0000 0.9952 0.0980
vn 0.0000 -0.9569 0.2903
vn 0.0000 0.4714 -0.8819
vn 0.0000 -0.2903 -0.9569
vn 0.0000 0.9569 0.2903
vn -0.5773 -0.5773 0.5773
vn 0.9756 0.2197 0.0000
vn 0.5773 -0.5773 -0.5773
vn -0.9756 0.2197 0.0000
usemtl Material.004
s 1
f 2/1/1 4/2/1 1/3/1
f 11/4/2 12/5/2 7/6/2
f 4/7/3 15/8/3 1/9/3
f 2/10/4 17/11/4 3/12/4
f 17/11/5 19/13/5 18/14/5
f 21/15/6 8/16/6 20/17/6
f 23/18/7 10/19/7 22/20/7
f 24/21/8 11/22/8 23/18/8
f 25/23/9 18/24/9 19/25/9
f 2/26/10 1/27/10 21/28/10
f 20/17/11 26/29/11 25/23/11
f 22/20/12 9/30/12 21/15/12
f 27/31/13 12/32/13 24/21/13
f 15/33/14 13/34/14 27/31/14
f 55/35/2 59/36/2 43/37/2
f 61/38/4 62/39/4 60/40/4
f 6/41/3 64/42/3 63/43/3
f 66/44/3 68/45/3 65/46/3
f 63/43/2 70/47/2 71/48/2
f 73/49/4 75/50/4 72/51/4
f 74/52/15 65/53/15 75/54/15
f 7/55/15 63/56/15 62/57/15
f 84/58/2 85/59/2 72/60/2
f 72/61/1 67/62/1 73/63/1
f 94/64/2 64/42/2 93/65/2
f 97/66/10 105/67/10 106/68/10
f 93/65/2 122/69/2 123/70/2
f 106/71/16 124/72/16 123/73/16
f 103/74/17 127/75/17 126/76/17
f 104/77/18 126/76/18 125/78/18
f 133/79/19 135/80/19 132/81/19
f 108/82/20 122/83/20 121/84/20
f 107/85/21 123/73/21 122/83/21
f 110/86/22 120/87/22 119/88/22
f 137/89/23 115/90/23 136/91/23
f 98/92/24 139/93/24 131/94/24
f 141/95/25 143/96/25 140/97/25
f 99/98/26 131/94/26 130/99/26
f 145/100/27 136/91/27 144/101/27
f 111/102/28 119/103/28 118/104/28
f 147/105/29 149/106/29 146/107/29
f 132/108/2 135/109/2 60/110/2
f 112/111/30 118/104/30 117/112/30
f 102/113/14 128/114/14 127/115/14
f 156/116/31 155/117/31 154/118/31
f 133/119/10 158/120/10 74/121/10
f 134/122/32 140/97/32 135/80/32
f 101/123/33 129/124/33 128/114/33
f 148/125/9 150/126/9 149/106/9
f 160/127/34 152/128/34 151/129/34
f 114/130/35 116/131/35 115/90/35
f 109/132/36 121/84/36 120/87/36
f 158/133/37 132/81/37 153/134/37
f 105/135/38 125/78/38 124/72/38
f 138/136/39 146/107/39 139/93/39
f 157/137/40 144/101/40 155/138/40
f 113/139/41 117/112/41 116/131/41
f 100/140/42 130/99/42 129/124/42
f 159/141/43 153/134/43 152/128/43
f 142/142/44 154/118/44 143/96/44
f 161/143/45 151/129/45 150/144/45
f 53/145/46 163/146/46 162/147/46
f 50/148/17 165/149/17 164/150/17
f 51/151/47 164/150/47 166/152/47
f 37/153/48 85/154/48 84/155/48
f 55/156/49 168/157/49 167/158/49
f 54/159/50 162/147/50 168/157/50
f 57/160/22 170/161/22 169/162/22
f 30/163/51 92/164/51 91/165/51
f 45/166/12 77/167/12 76/168/12
f 35/169/52 87/170/52 86/171/52
f 46/172/7 76/168/7 171/173/7
f 31/174/53 91/165/53 90/175/53
f 58/176/28 169/162/28 172/177/28
f 43/178/11 79/179/11 78/180/11
f 59/181/54 172/177/54 173/182/54
f 49/183/14 174/184/14 165/149/14
f 33/185/31 89/186/31 88/187/31
f 36/188/55 86/171/55 85/154/55
f 48/189/13 175/190/13 174/191/13
f 42/192/9 80/193/9 79/179/9
f 40/194/56 82/195/56 81/196/56
f 29/197/57 176/198/57 92/164/57
f 56/199/58 167/158/58 170/200/58
f 38/201/59 84/155/59 83/202/59
f 52/203/60 166/152/60 163/146/60
f 44/204/6 78/180/6 77/167/6
f 32/205/61 90/175/61 89/186/61
f 47/206/8 171/173/8 175/190/8
f 28/207/62 173/182/62 176/198/62
f 39/208/63 83/202/63 82/195/63
f 34/209/44 88/210/44 87/170/44
f 65/211/2 162/212/2 163/213/2
f 41/214/45 81/196/45 80/215/45
f 60/216/1 5/217/1 61/218/1
f 62/219/10 63/220/10 71/221/10
f 61/222/2 4/2/2 3/223/2
f 70/47/2 93/65/2 71/48/2
f 66/224/64 178/225/65 67/226/65
f 69/227/3 178/228/3 177/229/3
f 94/230/4 180/231/4 179/232/4
f 180/233/15 69/234/15 177/235/15
f 94/236/1 178/237/1 95/238/1
f 64/239/66 69/240/65 63/241/65
f 179/242/10 97/66/10 96/243/10
f 67/244/10 179/242/10 96/243/10
f 180/245/10 66/44/10 97/66/10
f 2/1/1 3/223/1 4/2/1
f 14/246/2 4/2/2 5/247/2
f 6/248/2 7/6/2 12/5/2
f 7/6/2 8/249/2 9/250/2
f 10/251/2 7/6/2 9/250/2
f 14/246/2 5/247/2 6/248/2
f 12/5/2 13/252/2 6/248/2
f 13/252/2 14/246/2 6/248/2
f 10/251/2 11/4/2 7/6/2
f 4/7/3 14/253/3 15/8/3
f 2/10/4 16/254/4 17/11/4
f 17/11/5 16/254/5 19/13/5
f 21/15/6 9/30/6 8/16/6
f 23/18/7 11/22/7 10/19/7
f 24/21/8 12/32/8 11/22/8
f 25/23/9 26/29/9 18/24/9
f 1/27/10 15/255/10 27/256/10
f 27/256/10 24/257/10 1/27/10
f 24/257/10 23/258/10 1/27/10
f 23/258/10 22/259/10 1/27/10
f 22/259/10 21/28/10 1/27/10
f 21/28/10 20/260/10 2/26/10
f 20/260/10 25/261/10 2/26/10
f 25/261/10 19/262/10 16/263/10
f 16/263/10 2/26/10 25/261/10
f 20/17/11 8/16/11 26/29/11
f 22/20/12 10/19/12 9/30/12
f 27/31/13 13/34/13 12/32/13
f 15/33/14 14/264/14 13/34/14
f 59/36/2 28/265/2 29/266/2
f 29/266/2 30/267/2 59/36/2
f 30/267/2 31/268/2 59/36/2
f 31/268/2 32/269/2 33/270/2
f 33/270/2 34/271/2 31/268/2
f 34/271/2 35/272/2 31/268/2
f 35/272/2 36/273/2 37/274/2
f 37/274/2 38/275/2 39/276/2
f 39/276/2 40/277/2 41/278/2
f 41/278/2 42/279/2 39/276/2
f 42/279/2 43/37/2 39/276/2
f 43/37/2 44/280/2 45/281/2
f 45/281/2 46/282/2 47/283/2
f 47/283/2 48/284/2 49/285/2
f 49/285/2 50/286/2 47/283/2
f 50/286/2 51/287/2 47/283/2
f 51/287/2 52/288/2 53/289/2
f 53/289/2 54/290/2 51/287/2
f 54/290/2 55/35/2 51/287/2
f 55/35/2 56/291/2 57/292/2
f 57/292/2 58/293/2 55/35/2
f 58/293/2 59/36/2 55/35/2
f 35/272/2 37/274/2 39/276/2
f 43/37/2 45/281/2 51/287/2
f 45/281/2 47/283/2 51/287/2
f 59/36/2 31/268/2 35/272/2
f 35/272/2 39/276/2 59/36/2
f 39/276/2 43/37/2 59/36/2
f 51/287/2 55/35/2 43/37/2
f 61/38/4 7/294/4 62/39/4
f 6/41/3 5/295/3 64/42/3
f 66/44/3 67/244/3 68/45/3
f 63/43/2 69/296/2 70/47/2
f 73/49/4 74/297/4 75/50/4
f 74/52/15 66/298/15 65/53/15
f 7/55/15 6/299/15 63/56/15
f 75/300/2 76/301/2 77/302/2
f 75/300/2 77/302/2 78/303/2
f 91/304/2 92/305/2 72/60/2
f 90/306/2 91/304/2 72/60/2
f 75/300/2 78/303/2 79/307/2
f 75/300/2 79/307/2 80/308/2
f 89/309/2 90/306/2 72/60/2
f 88/310/2 89/309/2 72/60/2
f 75/300/2 80/308/2 81/311/2
f 75/300/2 81/311/2 82/312/2
f 87/313/2 88/310/2 72/60/2
f 86/314/2 87/313/2 72/60/2
f 75/300/2 82/312/2 83/315/2
f 75/300/2 83/315/2 84/58/2
f 85/59/2 86/314/2 72/60/2
f 75/300/2 84/58/2 72/60/2
f 72/61/1 68/316/1 67/62/1
f 94/64/2 95/317/2 64/42/2
f 114/318/10 73/319/10 113/320/10
f 73/319/10 96/243/10 113/320/10
f 97/66/10 74/121/10 99/321/10
f 74/121/10 98/322/10 99/321/10
f 112/323/10 113/320/10 96/243/10
f 97/66/10 99/321/10 100/324/10
f 97/66/10 100/324/10 101/325/10
f 111/326/10 112/323/10 96/243/10
f 110/327/10 111/326/10 96/243/10
f 97/66/10 101/325/10 102/328/10
f 97/66/10 102/328/10 103/329/10
f 109/330/10 110/327/10 96/243/10
f 108/331/10 109/330/10 96/243/10
f 97/66/10 103/329/10 104/332/10
f 97/66/10 104/332/10 105/67/10
f 108/331/10 96/243/10 107/333/10
f 96/243/10 97/66/10 106/68/10
f 107/333/10 96/243/10 106/68/10
f 131/334/2 62/335/2 130/336/2
f 62/335/2 71/48/2 130/336/2
f 93/65/2 60/110/2 116/337/2
f 60/110/2 115/338/2 116/337/2
f 129/339/2 130/336/2 71/48/2
f 93/65/2 116/337/2 117/340/2
f 93/65/2 117/340/2 118/341/2
f 128/342/2 129/339/2 71/48/2
f 127/343/2 128/342/2 71/48/2
f 93/65/2 118/341/2 119/344/2
f 93/65/2 119/344/2 120/345/2
f 126/346/2 127/343/2 71/48/2
f 125/347/2 126/346/2 71/48/2
f 93/65/2 120/345/2 121/348/2
f 93/65/2 121/348/2 122/69/2
f 125/347/2 71/48/2 124/349/2
f 71/48/2 93/65/2 123/70/2
f 124/349/2 71/48/2 123/70/2
f 106/71/16 105/135/16 124/72/16
f 103/74/17 102/350/17 127/75/17
f 104/77/18 103/74/18 126/76/18
f 133/79/19 134/122/19 135/80/19
f 108/82/20 107/85/20 122/83/20
f 107/85/21 106/71/21 123/73/21
f 110/86/22 109/132/22 120/87/22
f 137/89/23 114/130/23 115/90/23
f 98/92/24 138/136/24 139/93/24
f 141/95/25 142/142/25 143/96/25
f 99/98/26 98/92/26 131/94/26
f 145/100/27 137/89/27 136/91/27
f 111/102/28 110/351/28 119/103/28
f 147/105/29 148/125/29 149/106/29
f 62/335/2 131/334/2 139/352/2
f 62/335/2 139/352/2 146/353/2
f 136/354/2 115/338/2 60/110/2
f 144/355/2 136/354/2 60/110/2
f 62/335/2 146/353/2 149/356/2
f 62/335/2 149/356/2 150/357/2
f 155/358/2 144/355/2 60/110/2
f 154/359/2 155/358/2 60/110/2
f 62/335/2 150/357/2 151/360/2
f 62/335/2 151/360/2 152/361/2
f 143/362/2 154/359/2 60/110/2
f 140/363/2 143/362/2 60/110/2
f 62/335/2 152/361/2 153/364/2
f 62/335/2 153/364/2 132/108/2
f 135/109/2 140/363/2 60/110/2
f 62/335/2 132/108/2 60/110/2
f 112/111/30 111/102/30 118/104/30
f 102/113/14 101/123/14 128/114/14
f 156/116/31 157/365/31 155/117/31
f 73/319/10 114/318/10 137/366/10
f 73/319/10 137/366/10 145/367/10
f 138/368/10 98/322/10 74/121/10
f 147/369/10 138/368/10 74/121/10
f 73/319/10 145/367/10 157/370/10
f 73/319/10 157/370/10 156/371/10
f 148/372/10 147/369/10 74/121/10
f 161/373/10 148/372/10 74/121/10
f 73/319/10 156/371/10 142/374/10
f 73/319/10 142/374/10 141/375/10
f 160/376/10 161/373/10 74/121/10
f 159/377/10 160/376/10 74/121/10
f 73/319/10 141/375/10 134/378/10
f 73/319/10 134/378/10 133/119/10
f 158/120/10 159/377/10 74/121/10
f 73/319/10 133/119/10 74/121/10
f 134/122/32 141/95/32 140/97/32
f 101/123/33 100/140/33 129/124/33
f 148/125/9 161/379/9 150/126/9
f 160/127/34 159/141/34 152/128/34
f 114/130/35 113/139/35 116/131/35
f 109/132/36 108/82/36 121/84/36
f 158/133/37 133/79/37 132/81/37
f 105/135/38 104/77/38 125/78/38
f 138/136/39 147/105/39 146/107/39
f 157/137/40 145/100/40 144/101/40
f 113/139/41 112/111/41 117/112/41
f 100/140/42 99/98/42 130/99/42
f 159/141/43 158/133/43 153/134/43
f 142/142/44 156/116/44 154/118/44
f 161/143/45 160/127/45 151/129/45
f 53/145/46 52/203/46 163/146/46
f 50/148/17 49/183/17 165/149/17
f 51/151/47 50/148/47 164/150/47
f 37/153/48 36/188/48 85/154/48
f 55/156/49 54/159/49 168/157/49
f 54/159/50 53/145/50 162/147/50
f 57/160/22 56/380/22 170/161/22
f 30/163/51 29/197/51 92/164/51
f 45/166/12 44/204/12 77/167/12
f 35/169/52 34/209/52 87/170/52
f 46/172/7 45/166/7 76/168/7
f 31/174/53 30/163/53 91/165/53
f 58/176/28 57/160/28 169/162/28
f 43/178/11 42/192/11 79/179/11
f 59/181/54 58/176/54 172/177/54
f 49/183/14 48/381/14 174/184/14
f 33/185/31 32/205/31 89/186/31
f 36/188/55 35/169/55 86/171/55
f 48/189/13 47/206/13 175/190/13
f 42/192/9 41/382/9 80/193/9
f 40/194/56 39/208/56 82/195/56
f 29/197/57 28/207/57 176/198/57
f 56/199/58 55/156/58 167/158/58
f 38/201/59 37/153/59 84/155/59
f 52/203/60 51/151/60 166/152/60
f 44/204/6 43/178/6 78/180/6
f 32/205/61 31/174/61 90/175/61
f 47/206/8 46/172/8 171/173/8
f 28/207/62 59/181/62 173/182/62
f 39/208/63 38/201/63 83/202/63
f 34/209/44 33/383/44 88/210/44
f 76/301/2 75/300/2 171/384/2
f 75/300/2 65/211/2 175/385/2
f 171/384/2 75/300/2 175/385/2
f 65/211/2 68/386/2 162/212/2
f 68/386/2 72/60/2 173/387/2
f 169/388/2 68/386/2 172/389/2
f 72/60/2 92/305/2 176/390/2
f 72/60/2 176/390/2 173/387/2
f 173/387/2 172/389/2 68/386/2
f 174/391/2 175/385/2 65/211/2
f 165/392/2 174/391/2 65/211/2
f 68/386/2 169/388/2 170/393/2
f 68/386/2 170/393/2 167/394/2
f 164/395/2 165/392/2 65/211/2
f 166/396/2 164/395/2 65/211/2
f 68/386/2 167/394/2 168/397/2
f 68/386/2 168/397/2 162/212/2
f 163/213/2 166/396/2 65/211/2
f 41/214/45 40/194/45 81/196/45
f 60/216/1 64/398/1 5/217/1
f 61/222/2 5/247/2 4/2/2
f 3/223/2 17/399/2 61/222/2
f 17/399/2 18/400/2 7/6/2
f 61/222/2 17/399/2 7/6/2
f 18/400/2 26/401/2 7/6/2
f 26/401/2 8/249/2 7/6/2
f 70/47/2 94/64/2 93/65/2
f 66/224/64 177/402/10 178/225/65
f 69/227/3 95/403/3 178/228/3
f 94/230/4 70/404/4 180/231/4
f 180/233/15 70/405/15 69/234/15
f 94/236/1 179/406/1 178/237/1
f 64/239/66 95/407/67 69/240/65
f 179/242/10 180/245/10 97/66/10
f 67/244/10 178/408/10 179/242/10
f 180/245/10 177/409/10 66/44/10

`;

  const objFile = new obj.default(file);
  console.log(objFile);
  const output = objFile.parse();

  let v: number[] = [];
  let i: number[] = [];

  output["models"][0]["vertices"].forEach((value) => {
    v.push(value.x, value.y, value.z);
  });

  output["models"][0]["faces"].forEach((face) => {
    face.vertices.forEach((vertex) => i.push(vertex["vertexIndex"] - 1));
  });

  console.log(v);
  console.log(i);

  array = new VertexArray(new Float32Array(v), new Int32Array(i));
  console.log("startup");
}

function draw(): void {
  gl.clearColor(1.0, 0.7, 0.4, 1.0);
  gl.enable(gl.DEPTH_TEST);
  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

  let model: glm.mat4 = glm.mat4.create();
  model = glm.mat4.identity(model);

  camera.ProcessMouseMovement(currentX - lastX, currentY - lastY);

  lastX = currentX;
  lastY = currentY;

  camera.ProcessMouseWheel(wheelOffset);
  wheelOffset = 0;

  let view: glm.mat4 = camera.GetLookAt();

  let proj: glm.mat4 = glm.mat4.create();
  proj = glm.mat4.identity(proj);
  glm.mat4.perspective(proj, glm.glMatrix.toRadian(45.0), width / height, 0.1, 1000);

  shader.use();
  shader.setMat4("model", model as Float32Array);
  shader.setMat4("view", view as Float32Array);
  shader.setMat4("proj", proj as Float32Array);

  array.use();
  gl.drawElements(gl.TRIANGLES, 1071, gl.UNSIGNED_INT, 0);

  window.requestAnimationFrame(draw);
}

startup();
draw();
